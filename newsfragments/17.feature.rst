Heavy improvements, add async yield fixture, fix bugs, add tests etc.
